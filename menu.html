<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Catalog</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* =================== Global Styles =================== */
      body {
        font-family: "Noto Sans Thai", sans-serif;
        margin: 0;
        padding: 0;
        background: #f9fbfd;
        color: #333;
      }
      h1 {
        text-align: center;
        background: linear-gradient(135deg, #ff1493, #ff85c0);
        color: white;
        padding: 20px 0;
        margin: 0;
        font-size: 28px;
        font-weight: 600;
        letter-spacing: 1px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      /* =================== Sticky Category Menu =================== */
      .sticky-menu {
        position: sticky;
        top: 0;
        background: #fff;
        z-index: 999;
        display: flex;
        overflow-x: auto;
        padding: 8px 10px;
        gap: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .sticky-menu button {
        flex-shrink: 0;
        padding: 6px 14px;
        border: none;
        border-radius: 20px;
        background: #009688;
        color: #fff;
        cursor: pointer;
        transition: 0.3s;
        font-family: "Noto Sans Thai", sans-serif;
      }
      .sticky-menu button.active {
        background: #ff1493;
        transform: scale(1.05);
      }

      /* =================== Controls =================== */
      .controls {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin: 0px;
        flex-wrap: wrap;
        max-width: 800px;
        padding: 10px;
        background: #fff;
        position: sticky;
        top: 60px;
        z-index: 998;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }
      /* Hide controls when scrolling down */
      .controls.hidden {
        transform: translateY(-120px);
        opacity: 0;
        pointer-events: none;
      }

      /* =================== Category Section =================== */
      .category-section {
        margin: 40px auto;
        max-width: 1200px;
        padding: 0 0px;
        scroll-margin-top: 80px;
      }

      .category-header {
        font-size: 24px;
        font-weight: 600;
        color: #00796b;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #ff1493;
        display: inline-block;
      }

      /* =================== Product Grid =================== */
      .products {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(50px, 150px));
        gap: 25px;
        max-width: 100%;
        margin: auto;
        justify-self: center;
      }
      .product-card {
        background: #fff;
        border-radius: 16px;
        overflow: hidden;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
      }

      .product-card img {
        width: 100%;
        height: 180px;
        object-fit: contain;
        object-position: center;
        background: #f0f0f0;
        display: block;
      }

      .product-info {
        padding: 15px;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .product-info h3 {
        margin: 0 0 8px 0;
        color: #00796b;
        font-size: 18px;
        font-weight: 600;
      }
      .price {
        display: inline-block;
        background: #e91e63;
        color: white;
        font-weight: bold;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 14px;
        margin-top: 5px;
        white-space: nowrap;
      }

      .types span {
        display: inline-block;
        margin: 5px 5px 0 0;
        background: #009688;
        color: #fff;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        transition: background 0.3s;
      }

      /* =================== Modal =================== */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        visibility: hidden;
        transition: 0.3s;
        z-index: 1000;
      }
      .modal.active {
        opacity: 1;
        visibility: visible;
      }
      .modal-content {
        background: #fff;
        border-radius: 16px;
        max-width: 650px;
        width: 90%;
        max-height: 85%;
        overflow-y: auto;
        position: relative;
        padding: 20px;
        animation: fadeInUp 0.3s ease;
      }
      @keyframes fadeInUp {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .modal-close {
        position: absolute;
        top: 12px;
        right: 15px;
        cursor: pointer;
        font-size: 24px;
        color: #666;
        transition: 0.2s;
      }
      .carousel img {
        width: 100%;
        height: auto;
        object-fit: contain;
        object-position: center;
        background: #fff;
        display: block;
        border-radius: 8px;
      }

      /* =================== Loader =================== */
      .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #ff1493;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 50px auto;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* =================== Empty State =================== */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #999;
      }
      .empty-state h3 {
        font-size: 20px;
        margin-bottom: 10px;
      }

      /* =================== Scroll to Top Button =================== */
      .scroll-to-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #ff1493, #ff85c0);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: 0 4px 12px rgba(255, 20, 147, 0.4);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 998;
      }
      .scroll-to-top.visible {
        opacity: 1;
        visibility: visible;
      }
      .scroll-to-top:active {
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <h1>
      <img
        src="/placeholder.svg"
        alt="‡∏£‡πâ‡∏≤‡∏ô‡πÇ‡∏õ‡∏£‡∏î Logo"
        style="height: 100px; vertical-align: middle; margin-right: 10px"
      />
      ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    </h1>

    <!-- Sticky Category Menu -->
    <div class="sticky-menu" id="stickyMenu"></div>

    <!-- Controls -->
    <div class="controls" id="controls">
      <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." />
    </div>

    <!-- Product Container -->
    <div id="productContainer">
      <div class="loader"></div>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top" id="scrollToTop" aria-label="‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô">
      ‚Üë
    </button>

    <!-- Modal -->
    <div class="modal" id="modal">
      <div class="modal-content">
        <span class="modal-close" id="modalClose">&times;</span>
        <div id="modalBody"></div>
      </div>
    </div>

    <script>
      // =================== Variables ===================
      const apiURL =
        "https://script.google.com/macros/s/AKfycbwLaZWpjeMjqskUHsn6JeIMdd6np4A7xE_MiS8u9COtjI09jcotG-3lQjWtS5EilMzY/exec";
      let data = [];

      const productContainer = document.getElementById("productContainer");
      const searchInput = document.getElementById("searchInput");
      const stickyMenu = document.getElementById("stickyMenu");
      const modal = document.getElementById("modal");
      const modalBody = document.getElementById("modalBody");
      const modalClose = document.getElementById("modalClose");
      const scrollToTopBtn = document.getElementById("scrollToTop");
      const controls = document.getElementById("controls");
      const blankImg =
        "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAeAB4AAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9/KKKKAP/2Q==";

      // =================== Load Data ===================
      fetch(apiURL)
        .then((res) => res.json())
        .then((resData) => {
          data = resData;
          populateTypeFilter();
          renderProducts(data);
          populateStickyMenu();
        })
        .catch((err) => {
          productContainer.innerHTML =
            '<div class="empty-state"><h3>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</h3><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p></div>';
          console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
        });

      function populateTypeFilter() {
        const allTypes = new Set();
        data.forEach((item) => {
          allTypes.add(item.category);
        });
        allTypes.forEach((type) => {
          const option = document.createElement("option");
          option.value = type;
          option.textContent = type;
        });
      }

      function populateStickyMenu() {
        stickyMenu.innerHTML = "";
        const allTypes = Array.from(new Set(data.map((item) => item.category)));
        allTypes.forEach((type) => {
          const btn = document.createElement("button");
          btn.textContent = type;
          btn.dataset.category = type;
          btn.addEventListener("click", () => {
            const targetSection = document.getElementById(`category-${type}`);
            if (targetSection) {
              targetSection.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          });
          stickyMenu.appendChild(btn);
        });
      }

      function renderProducts(products) {
        productContainer.innerHTML = "";

        if (products.length === 0) {
          productContainer.innerHTML =
            '<div class="empty-state"><h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3><p>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô</p></div>';
          return;
        }

        // Group products by category
        const groupedProducts = {};
        products.forEach((item) => {
          if (!groupedProducts[item.category]) {
            groupedProducts[item.category] = [];
          }
          groupedProducts[item.category].push(item);
        });

        // Render each category section
        Object.keys(groupedProducts).forEach((category) => {
          const section = document.createElement("div");
          section.className = "category-section";
          section.id = `category-${category}`;

          const header = document.createElement("h2");
          header.className = "category-header";
          header.textContent = category;
          section.appendChild(header);

          const grid = document.createElement("div");
          grid.className = "products";

          groupedProducts[category].forEach((item) => {
            const images = item.url ? item.url.split(",") : [];
            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `
              <img src="${images.length ? images[0].trim() : blankImg}" alt="${
              item.name
            }">
              <div class="product-info">
                <h3>${item.name}</h3>
                <p class="price">${item.price} ‡∏ö‡∏≤‡∏ó</p>
                <div class="types"><span>${item.category}</span></div>
              </div>
            `;
            card.addEventListener("click", () => openModal(item));
            grid.appendChild(card);
          });

          section.appendChild(grid);
          productContainer.appendChild(section);
        });
      }

      function filterProducts() {
        const searchText = searchInput.value.toLowerCase();

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏° search text
        const filtered = data.filter((item) => {
          return (
            (item.name && item.name.toLowerCase().includes(searchText)) ||
            (item.description &&
              item.description.toLowerCase().includes(searchText))
          );
        });

        // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° category
        const groupedProducts = {};
        filtered.forEach((item) => {
          if (!groupedProducts[item.category]) {
            groupedProducts[item.category] = [];
          }
          groupedProducts[item.category].push(item);
        });

        // ‡πÅ‡∏õ‡∏•‡∏á groupedProducts ‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á category
        const sortedCategories = Object.keys(groupedProducts);

        // ‡∏•‡πâ‡∏≤‡∏á container ‡∏Å‡πà‡∏≠‡∏ô
        productContainer.innerHTML = "";

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ category
        sortedCategories.forEach((category) => {
          const section = document.createElement("div");
          section.className = "category-section";
          section.id = `category-${category}`;

          const header = document.createElement("h2");
          header.className = "category-header";
          header.textContent = category;
          section.appendChild(header);

          const grid = document.createElement("div");
          grid.className = "products";

          groupedProducts[category].forEach((item) => {
            const images = item.url ? item.url.split(",") : [];
            const card = document.createElement("div");
            card.className = "product-card";
            card.innerHTML = `
        <img src="${images.length ? images[0].trim() : blankImg}" alt="${
              item.name
            }">
        <div class="product-info">
          <h3>${item.name}</h3>
          <p class="price">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <div class="types"><span>${item.category}</span></div>
        </div>
      `;
            card.addEventListener("click", () => openModal(item));
            grid.appendChild(card);
          });

          section.appendChild(grid);
          productContainer.appendChild(section);
        });

        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        if (filtered.length === 0) {
          productContainer.innerHTML =
            '<div class="empty-state"><h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3><p>‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô</p></div>';
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï sticky menu ‡∏´‡∏•‡∏±‡∏á search
        highlightActiveCategory();
      }

      let lastScrollY = window.scrollY;
      let isScrolling = false;

      window.addEventListener("scroll", () => {
        if (!isScrolling) {
          window.requestAnimationFrame(() => {
            const currentScrollY = window.scrollY;

            if (currentScrollY < 100) {
              controls.classList.remove("hidden");
            } else if (currentScrollY > lastScrollY) {
              controls.classList.add("hidden");
            } else {
              controls.classList.remove("hidden");
            }

            lastScrollY = currentScrollY;
            highlightActiveCategory();
            toggleScrollToTopButton();
            isScrolling = false;
          });
          isScrolling = true;
        }
      });

      function highlightActiveCategory() {
        const buttons = stickyMenu.querySelectorAll("button");
        const sections = document.querySelectorAll(".category-section");

        buttons.forEach((btn) => btn.classList.remove("active"));

        const scrollPos = window.scrollY + 100;

        let activeSection = null;
        sections.forEach((section) => {
          const sectionTop = section.offsetTop;
          const sectionBottom = sectionTop + section.offsetHeight;

          if (scrollPos >= sectionTop && scrollPos < sectionBottom) {
            activeSection = section;
          }
        });

        if (activeSection) {
          const categoryId = activeSection.id.replace("category-", "");
          const activeBtn = Array.from(buttons).find(
            (btn) => btn.dataset.category === categoryId
          );
          if (activeBtn) {
            activeBtn.classList.add("active");
            activeBtn.scrollIntoView({
              behavior: "smooth",
              block: "nearest",
              inline: "center",
            });
          }
        }
      }

      function toggleScrollToTopButton() {
        if (window.scrollY > 300) {
          scrollToTopBtn.classList.add("visible");
        } else {
          scrollToTopBtn.classList.remove("visible");
        }
      }

      scrollToTopBtn.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      // =================== Modal ===================
      function openModal(item) {
        modalBody.innerHTML = `
          <h2 style="color:#00796b;margin-bottom:10px;">${item.name}</h2>
          <p style="margin-bottom:10px;">${
            item.description || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"
          }</p>
          <p class="price">${item.price} ‡∏ö‡∏≤‡∏ó</p>
          <div class="carousel">
            ${
              item.url
                ? `<img src="${item.url}" alt="${item.name}" />`
                : '<div style="padding:40px;text-align:center;color:#999;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>'
            }
          </div>
          <div class="types" style="margin-top:10px;">
            <span>${item.category}</span>
          </div>
        `;

        modal.classList.add("active");
      }

      modalClose.addEventListener("click", () =>
        modal.classList.remove("active")
      );
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.classList.remove("active");
      });

      searchInput.addEventListener("input", filterProducts);
    </script>
  </body>
</html>
